<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blazing â€” Manual Background Switch (Responsive)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/background.css" />
</head>

<body>
  <!-- Default background -->
  <div id="full-bg" class="bg-1"></div>

  <!-- HUD Bottom Bar -->
  <div class="bottom-bar">
    <div class="bottom-bar-content">
      <button class="hud-button" id="btn-summon" aria-label="Summon">
        <img src="assets/icons/summon_icon.png" alt="Summon">
      </button>
      <button class="hud-button" id="btn-missions" aria-label="Missions">
        <img src="assets/icons/missions_icon.png" alt="Missions">
      </button>
      <button class="hud-button" id="btn-characters" aria-label="Characters">
        <img src="assets/icons/characters_icon.png" alt="Characters">
      </button>
      <button class="hud-button" id="btn-teams" aria-label="Teams">
        <img src="assets/icons/teams_icon.png" alt="Teams">
      </button>
      <button class="hud-button" id="btn-fusion" aria-label="Fusion">
        <img src="assets/icons/fusion_icon.png" alt="Fusion">
      </button>
      <button class="hud-button" id="btn-addchar" aria-label="Add Character">
        <img src="assets/icons/add_icon.png" alt="Add Character">
      </button>
      <button class="hud-button" id="btn-settings" aria-label="Settings">
        <img src="assets/icons/settings_icon.png" alt="Settings">
      </button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/character_inv.js"></script>
  <script src="js/resources.js"></script>
  <script src="js/daily-missions.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("âœ… JavaScript loaded!");

      // Process login bonus
      if (typeof window.DailyMissions !== "undefined") {
        const loginResult = await window.DailyMissions.processLogin();
        if (loginResult.ok && !loginResult.alreadyClaimed) {
          const rewardText = Object.entries(loginResult.reward)
            .map(([mat, amt]) => `${mat}: ${amt}`)
            .join(", ");
          alert(`Login Bonus Day ${loginResult.loginDay}!\n\nRewards:\n${rewardText}`);
        }
      }

      // Background cycling
      const el = document.getElementById("full-bg");
      const total = 10;
      let current = 1;

      function updateBG(n) {
        for (let i = 1; i <= total; i++) {
          el.classList.remove(`bg-${i}`);
        }
        el.classList.add(`bg-${n}`);
        console.log(`ðŸŽ¨ Background changed to bg-${n}`);
      }

      // Navigation function
      function navigateTo(url) {
        console.log(`ðŸš€ Navigating to: ${url}`);
        document.body.style.transition = "opacity 0.2s linear";
        document.body.style.opacity = "0";
        setTimeout(() => { 
          window.location.href = url; 
        }, 200);
      }

      // Wire up navigation buttons
      const btnSummon = document.getElementById("btn-summon");
      if (btnSummon) {
        btnSummon.addEventListener("click", () => {
          console.log("ðŸ”® Summon clicked");
          navigateTo("summon.html");
        });
      }

      const btnMissions = document.getElementById("btn-missions");
      if (btnMissions) {
        btnMissions.addEventListener("click", () => {
          console.log("ðŸ“œ Missions clicked");
          navigateTo("missions.html");
        });
      }

      const btnCharacters = document.getElementById("btn-characters");
      if (btnCharacters) {
        btnCharacters.addEventListener("click", () => {
          console.log("ðŸ‘¤ Characters clicked");
          navigateTo("characters.html");
        });
      }

      const btnTeams = document.getElementById("btn-teams");
      if (btnTeams) {
        btnTeams.addEventListener("click", () => {
          console.log("ðŸ‘¥ Teams clicked");
          navigateTo("teams.html");
        });
      }

      // Fusion button
      const btnFusion = document.getElementById("btn-fusion");
      if (btnFusion) {
        btnFusion.addEventListener("click", () => {
          console.log("âš¡ Fusion clicked");
          navigateTo("fusion.html");
        });
      }

      // Add Character button
      const btnAddChar = document.getElementById("btn-addchar");
      if (btnAddChar) {
        btnAddChar.addEventListener("click", () => {
          console.log("âž• Add Character clicked");
          const id = prompt("Enter Character ID from characters.json (e.g. 'naruto_01')");
          if (id && typeof window.addCharacterById === "function") {
            window.addCharacterById(id.trim());
            console.log(`âœ… Added character: ${id}`);
          } else if (id) {
            console.error("âš ï¸ addCharacterById not loaded yet");
            alert("The Add Character system isn't ready yet. Please reload the page.");
          }
        });
      }

      // Settings button (with background changer and resources)
      const btnSettings = document.getElementById("btn-settings");
      if (btnSettings) {
        btnSettings.addEventListener("click", () => {
          console.log("âš™ï¸ Settings clicked");
          const choice = prompt("Settings Menu:\n1. Change Background (1-10)\n2. View Resources\n3. Cancel\n\nEnter your choice:");

          if (choice === "1") {
            const bgNum = prompt("Enter background number (1-10):");
            const num = parseInt(bgNum);
            if (num >= 1 && num <= 10) {
              current = num;
              updateBG(current);
            } else {
              alert("Invalid background number. Please enter 1-10.");
            }
          } else if (choice === "2") {
            navigateTo("resources.html");
          }
        });
      }

      console.log("âœ… All event listeners attached!");
    });
  </script>
</body>
</html>
